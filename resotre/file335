<template>
    <v-form ref="form">
        <v-row justify="center" no-gutters style="width: 560px">
            <v-col v-if="commonError" cols="12" sm="8">
                <v-alert
                    class="mt-5"
                    type="error"
                    transition="fade-transition"
                >{{commonError}}</v-alert>
            </v-col>
            <v-col cols="12" sm="8">
                <app-form-name
                        v-model="deck.name"
                        :error-message="errors.name"
                ></app-form-name>
            </v-col>
            <v-flex v-if="detailSettings.show">
                <v-row justify="center">
                    <v-col cols="12" sm="8">
                        <app-form-description
                            v-model="deck.description"
                            :error-message="errors.description">
                        </app-form-description>
                    </v-col>
                    <v-col cols="12" sm="8">
                        <app-form-slider
                            v-model:slider="deck.limit_repeat"
                            :error-message="errors.limit_repeat"
                            :hint="'Количество карточек доступных для повторения в день'"
                        >
                            <template v-slot:label="{value}">
                                <v-label>Повторение ({{value}})</v-label>
                            </template>
                        </app-form-slider>
                    </v-col>
                    <v-col cols="12" sm="8">
                        <app-form-slider
                            v-model:slider="deck.limit_learning"
                            :error-message="errors.limit_learning"
                            :hint="'Количество карточек доступных для повторения в день'"
                            :label="'Изучение'"
                        >
                            <template v-slot:label="{value}">
                                <v-label>Повторение ({{value}})</v-label>
                            </template>
                        </app-form-slider>
                    </v-col>
                    <v-col cols="12" sm="8">
                        <app-form-slider
                            v-model:slider="deck.difficulty_index"
                            :error-message="errors.difficulty_index"
                            :hint="'Этот коэффициент влияет вобщем на частоту повторения'"
                            :label="'Коэффициент сложности'"
                        >
                            <template v-slot:label="{value}">
                                <v-label>Коэффициент сложности ({{value}}%)</v-label>
                            </template>
                        </app-form-slider>
                    </v-col>
                    <v-col cols="12" sm="8">
                        <app-form-slider
                            v-model:slider="deck.base_index"
                            :error-message="errors.base_index"
                            :hint="'Из данного коэффициента рассчитываются периоды повторения'"
                            :label="'Базовый коэффициент'"
                        >
                            <template v-slot:label="{value}">
                                <v-label>Базовый коэффициент ({{value}})</v-label>
                            </template>
                        </app-form-slider>
                    </v-col>
                    <v-col cols="12" sm="9">
                        <app-form-slider
                            v-model:slider="deck.modifier_index"
                            :error-message="errors.modifier_index"
                            :hint="'Из данного коэффициента рассчитывается то насколько быстро будет первое повторение'"
                            :label="'Дополнительный коэффициент'"
                        >
                            <template v-slot:label="{value}">
                                <v-label>Дополнительный коэффициент ({{value}})</v-label>
                            </template>
                        </app-form-slider>
                    </v-col>
                </v-row>
            </v-flex>
        </v-row>
        <v-row :justify-sm="'center'">
            <v-col sm="auto">
                <v-btn
                    elevation="0"
                    @click="toggleDetailSettings"
                >{{detailSettings.message}}</v-btn>
                <v-btn color="primary" @click="onSubmitForm" :loading="isLoading">
                    <slot name="submit"></slot>
                </v-btn>
            </v-col>
        </v-row>
    </v-form>
</template>

<script>
    import AppFormName from "../../common/UI/FormElements/AppFormName";
    import AppFormDescription from "../../common/UI/FormElements/AppFormDescription";
    import AppFormNumber from "../../common/UI/FormElements/AppFormNumber";
    import AppFormSlider from "../../common/UI/FormElements/AppFormSlider";
    import {cloneObject, deckDefault} from "../../../../plugins/helpers";
    import {mapGetters} from "vuex";
    export default {
        name: "DeckForm",
        components: {AppFormSlider, AppFormNumber, AppFormDescription, AppFormName},
        props: {
            eventName: {
                type: String,
                required: true
            },
            deck: {},
            errors: {
                type: Object,
                default: deckDefault()
            },
            commonError: {
                default: false
            }
        },
        data: function () {
            return {
                valid: false,
                detailSettings: {
                    show: false,
                    message: 'Подробнее'
                }
            }
        },
        computed: {
            ...mapGetters('DeckStore', {
                isLoading: 'isLoading',
            })
        },
        methods: {
            toggleDetailSettings() {
                this.detailSettings.show = !this.detailSettings.show;
                if(this.detailSettings.show) {
                    this.detailSettings.message = 'Скрыть';
                } else {
                    this.detailSettings.message = 'Подробнее';
                }
            },

            onSubmitForm() {
                if (this.$refs.form.validate()) {
                    let tempDeck = cloneObject(deckDefault(
                        this.deck.limit_repeat,
                        this.deck.limit_repeat,
                        this.deck.difficulty_index,
                        this.deck.base_index,
                        this.deck.modifier_index,
                        this.deck.name,
                        this.deck.description
                    ));

                    this.$emit( this.eventName, tempDeck);

                }
            }
        }
    }
</script>

<style scoped>
    .centered-input >>> input {
        text-align: center
    }
</style>