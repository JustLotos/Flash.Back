<template>
    <v-card class="elevation-10">
        <v-toolbar color="primary" dark flat>
            <v-toolbar-title class="fill-width text-center">Авторизация</v-toolbar-title>
        </v-toolbar>
        <v-form ref="loginForm">
            <v-card-text>
                <v-row justify="center">
                    <v-col cols="12" lg="8" class="pa0">
                        <v-alert v-if="error" type="error" transition="fade-transition">{{error}}</v-alert>
                    </v-col>
                    <v-col cols="12" lg="8" class="pa0">
                        <v-text-field
                                v-model="payloads.email"
                                validate-on-blur
                                label="E-mail адресс"
                                type="email"
                                prepend-icon="mdi-email"
                        ></v-text-field>
                    </v-col>
                    <v-col cols="12" lg="8" class="pa0">
                        <v-text-field v-model="payloads.password"  label="Пароль" validate-on-blur prepend-icon="mdi-lock"
                                :type="show ? 'text' : 'password'"
                                :append-icon="show ? 'mdi-eye' : 'mdi-eye-off'"
                                @click:append="show = !show"
                        ></v-text-field>
                    </v-col>
                    <v-col cols="12" lg="8">
                        <div class="d-flex justify-center">
                            <v-checkbox v-model="payloads.rememberMe" :label="`Запомнить меня`"></v-checkbox>
                        </div>
                    </v-col>
                </v-row>
            </v-card-text>
            <v-divider></v-divider>
            <v-card-actions class="justify-center">
                <v-btn class="pa2" color="primary" @click="submit()">Войти</v-btn>
            </v-card-actions>
        </v-form>
    </v-card>
</template>

<script lang="ts">
import { Component, Vue } from 'vue-property-decorator';
import {LoginRequest} from "../../Service/types";
import {AuthModule} from "../../../../Store/Auth";
import {AxiosError} from "axios";
import {VueRouter} from "vue-router/types/router";

@Component
export default class LoginForm extends Vue {
    payloads: LoginRequest;
    show: boolean = true;
    error: string | null = '';

    constructor() {
        super();
        this.payloads = {email: 'ignashov-roman@mail.ru', password: '12345678', rememberMe: false};
    }

    public submit() {
        AuthModule.login(this.payloads)
            .then(() => {
                this.$emit('login');
            })
            .catch((error: AxiosError)=>{
                this.error = error.response?.data.errors.auth;
            });
    }
}
</script>